<div class="layout-invoice-page" *ngIf="master">
    <p-toast></p-toast>

    <p-toolbar styleClass="mb-3 align-items-start">
        <ng-template pTemplate="left">
            <app-details-card [master]="master" type="claim"></app-details-card>
        </ng-template>
        <ng-template pTemplate="right">
            <div class="field col">
                <p-confirmPopup></p-confirmPopup>
                <p-menu #menu [popup]="true" [model]="menuItems" [style]="{'width':'200px'}"></p-menu>
                <button pButton pRipple [disabled]="editAuth===false" class="mb-3 p-button-warning" type="button"
                    icon="pi pi-fw pi-cog" label="{{ 'operations.actions' | translate }}"
                    (click)="menu.toggle($event)"></button>
            </div>
            <div class="field">
                <button pButton pRipple label="Edit Claim" class="p-button-success mr-2 mb-3"
                    [disabled]="!(master.status.id == 1 && editAuth===true)" [routerLink]="['/edit-claim']"></button>
            </div>
        </ng-template>
    </p-toolbar>

    <div class="grid layout-invoice-content">
        <div class="col-12">
            <div class="mt-5">
                <p-tabView (onChange)="handleChange($event)" [(activeIndex)]="activeTab">
                    <p-tabPanel header="Claim Information">
                        <div class="pt-5 text-center" *ngIf="isFetching">
                            <p-progressSpinner [style]="{width: '50px', height: '50px', textAlign: 'center'}"
                                styleClass="custom-spinner" strokeWidth="8" fill="var(--surface-ground)"
                                animationDuration=".5s"></p-progressSpinner>
                        </div>
                        <div class="py-5 text-center" *ngIf="!isFetching && details.length == 0">
                            this claim has no requests
                        </div>
                        <p-table *ngIf="details.length > 0" dataKey="id" #dt [rows]="10" [value]="details"
                            styleClass="p-invoice-datatable-responsive pb-3" [paginator]="true">
                            <!-- <ng-template pTemplate="caption" class="pb-0">
                                <div class="border-300 border-bottom-1">
                                    <ng-container *ngFor="let state of status">
                                        <button (click)="filterByStatus(state)" pButton pRipple type="button"
                                            label="{{state}}"
                                            [ngClass]="{'active': selectedState == state, 'text-black-alpha-40': selectedState !== state}"
                                            class="mr-3 p-button-text"></button>
                                    </ng-container>
                                </div>
                            </ng-template> -->
                            <ng-template pTemplate="header">
                                <tr>
                                    <th pColumn="id">{{ 'common.id' | translate }}</th>
                                    <th>Part Name</th>
                                    <th>Request For</th>
                                    <th [hidden]="role == 2" style="text-align:center">
                                        {{'operations.actions' | translate }}</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-part>
                                <tr>
                                    <td>
                                        {{part.id}}
                                    </td>
                                    <td>
                                        {{part.part.name}}
                                    </td>
                                    <td>
                                        {{part.partOption}}
                                    </td>
                                   <td>action</td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </p-tabPanel>
                    <!-- <p-tabPanel *ngIf="viewAuth == true" header="{{ 'job.tableColumn.receivedBids' | translate }}">
                        <div class="py-5 px-3">
                            <button (click)="onCompareBids()" pButton pRipple type="button" label="Compare Bids"
                                class="p-button-rounded bg-indigo-100 text-indigo-600 border-0 font-light px-5"></button>
                        </div>

                        <p-table [columns]="cols" [rows]="10" [value]="supplierBids"
                            styleClass="p-invoice-datatable-responsive pb-3" *ngIf="visible" [paginator]="true">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>Select</th>
                                    <th pColumn="supplierName">{{ 'bid.tableColumn.supplierName' | translate }}</th>
                                    <th pColumn="status">{{ 'bid.tableColumn.status' | translate }}</th>
                                    <th pColumn="bidDate">{{ 'bid.tableColumn.bidDate' | translate }}</th>
                                    <th pColumn="bidValue">{{ 'bid.tableColumn.bidValue' | translate }}</th>
                                    <th pColumn="submittedBids">{{ 'bid.tableColumn.submittedBids' | translate }}
                                    </th>
                                    <th [hidden]="printingMode===true">{{
                                        'bid.title' | translate }}</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-bid>
                                <tr>
                                    <td>
                                        <p-checkbox [binary]="true" (onChange)="onToggleBid(bid)"></p-checkbox>
                                    </td>
                                    <td>
                                        {{bid.supplierName}}
                                    </td>
                                    <td>
                                        {{getStatusName(bid.statusId)}}
                                    </td>
                                    <td>
                                        {{bid.bidDate | date: 'dd/MM/yyyy hh:mm'}}
                                    </td>
                                    <td>
                                        {{getTotalPriceForSupplier(bid.supplierId) | number}}
                                    </td>
                                    <td>
                                        {{getTotalSubmittedBidsForSupplier(bid.supplierId)}}
                                    </td>
                                    <td [hidden]="printingMode===true">
                                        <button pButton pRipple icon="pi pi-eye"
                                            class="p-button-rounded p-button-success mr-2"
                                            (click)="viewBidsBySupplier(bid)"></button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </p-tabPanel> -->
                    <p-tabPanel *ngIf="newAuth == true" header="{{ 'job.tableColumn.addBids' | translate }}">
                        <!-- <app-new-bid *ngIf="details.length > 0" [requests]="details"></app-new-bid> -->
                    </p-tabPanel>
                </p-tabView>
            </div>

        </div>

    </div>
</div>

<!-- confirm action dialog -->
<p-dialog [(visible)]="confirmActionDialog" header="{{ 'operations.confirmAction' | translate}}" [modal]="true"
    [style]="{width:'450px'}">
    <div class="flex align-items-center justify-content-center">
        <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
        <span><b>{{ 'operations.confirmActionMessage' | translate }}</b></span>
    </div>
    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No"
            (click)="confirmActionDialog = false"></button>
        <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes" (click)="confirm()"></button>
    </ng-template>
</p-dialog>
